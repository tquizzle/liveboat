{"id":"USgKoryE83j5SszZjyr68sh7DjLn4j6MWUZnq3yP65Dn8JeZvtkCK4CH5NHeBXVS23cgTUZEuSrUb22BVGJo3s","title":"top scoring links : Affine","displayTitle":"Reddit - Affine","url":"https://www.reddit.com/r/affine/top/.rss?sort=top&t=day&limit=6","feedLink":"https://www.reddit.com/r/affine/top/?sort=top&t=day&limit=6","items":[{"title":"reset after update","url":"https://www.reddit.com/r/Affine/comments/1hmovfk/reset_after_update/","date":1735221508,"author":"/u/brokesadnerd","unread":true,"desc":"","content":"<!-- SC_OFF --><div class=\"md\"><p>Hello everyone!</p> <p>I am self hosting Affine on my Raspberry Pi 5 using Docker with Portainer. I noticed that after almost each update of the Docker image I need to re-configure the admin user and other settings; with this I also lose all the notes I take as the instance seems to restart from scratch.</p> <p>I deployed it using a Portainer stack and saving all my data on an external HDD; this is the configuration:</p> <p><code>services:</code></p> <p><code>affine:</code></p> <p><code>image:</code> <a href=\"http://ghcr.io/toeverything/affine-graphql:stable\"><code>ghcr.io/toeverything/affine-graphql:stable</code></a></p> <p><code>container_name: affine_selfhosted</code></p> <p><code>command:</code></p> <p><code>[&#39;sh&#39;, &#39;-c&#39;, &#39;node ./scripts/self-host-predeploy &amp;&amp; node ./dist/index.js&#39;]</code></p> <p><code>ports:</code></p> <p><code>- &#39;3010:3010&#39;</code></p> <p><code>- &#39;5555:5555&#39;</code></p> <p><code>depends_on:</code></p> <p><code>redis:</code></p> <p><code>condition: service_healthy</code></p> <p><code>postgres:</code></p> <p><code>condition: service_healthy</code></p> <p><code>volumes:</code></p> <p><code># custom configurations</code></p> <p><code>- /path/to/my/HDD/AFFiNE/self-host/config:/root/.affine/config</code></p> <p><code># blob storage</code></p> <p><code>- /path/to/my/HDD/AFFiNE/self-host/storage:/root/.affine/storage</code></p> <p><code>logging:</code></p> <p><code>driver: &#39;json-file&#39;</code></p> <p><code>options:</code></p> <p><code>max-size: &#39;1000m&#39;</code></p> <p><code>restart: unless-stopped</code></p> <p><code>environment:</code></p> <p><code>- NODE_OPTIONS=&quot;--import=./scripts/register.js&quot;</code></p> <p><code>- AFFINE_CONFIG_PATH=/root/.affine/config</code></p> <p><code>- REDIS_SERVER_HOST=redis</code></p> <p><code>- DATABASE_URL=postgres://affine:affine@postgres:5432/affine</code></p> <p><code>- NODE_ENV=production</code></p> <p><code>- AFFINE_ADMIN_EMAIL=${AFFINE_ADMIN_EMAIL}</code></p> <p><code>- AFFINE_ADMIN_PASSWORD=${AFFINE_ADMIN_PASSWORD}</code></p> <p><code># Telemetry allows us to collect data on how you use the affine. This data will helps us improve the app and provide better features.</code></p> <p><code># Uncomment next line if you wish to quit telemetry.</code></p> <p><code>- TELEMETRY_ENABLE=false</code></p> <p><code># Mailer</code></p> <p><code>- MAILER_HOST=${MAILER_HOST}</code></p> <p><code>- MAILER_PORT=${MAILER_PORT}</code></p> <p><code>- MAILER_USER=${MAILER_USER}</code></p> <p><code>- MAILER_PASSWORD=${MAILER_PASSWORD}</code></p> <p><code>- MAILER_SENDER=${MAILER_SENDER}</code></p> <p><code># - MAILER_SECURE=${MAILER_SECURE}</code></p> <p><code># Others</code></p> <p><code>- AFFINE_SERVER_EXTERNAL_URL=https://my-domain.com</code></p> <p><code>redis:</code></p> <p><code>image: redis</code></p> <p><code>container_name: affine_redis</code></p> <p><code>restart: unless-stopped</code></p> <p><code>volumes:</code></p> <p><code>- /path/to/my/HDD/AFFiNE/self-host/redis:/data</code></p> <p><code>healthcheck:</code></p> <p><code>test: [&#39;CMD&#39;, &#39;redis-cli&#39;, &#39;--raw&#39;, &#39;incr&#39;, &#39;ping&#39;]</code></p> <p><code>interval: 10s</code></p> <p><code>timeout: 5s</code></p> <p><code>retries: 5</code></p> <p><code>postgres:</code></p> <p><code>image: postgres</code></p> <p><code>container_name: affine_postgres</code></p> <p><code>restart: unless-stopped</code></p> <p><code>volumes:</code></p> <p><code>- /path/to/my/HDD/AFFiNE/self-host/postgres:/var/lib/postgresql/data</code></p> <p><code>healthcheck:</code></p> <p><code>test: [&#39;CMD-SHELL&#39;, &#39;pg_isready -U affine&#39;]</code></p> <p><code>interval: 10s</code></p> <p><code>timeout: 5s</code></p> <p><code>retries: 5</code></p> <p><code>environment:</code></p> <p><code>POSTGRES_USER: affine</code></p> <p><code>POSTGRES_PASSWORD: affine</code></p> <p><code>POSTGRES_DB: affine</code></p> <p><code>PGDATA: /path/to/my/HDD/AFFiNE/data/pgdata</code></p> <p>Right now I am running <em>0.18.0-nightly-a9aa31a</em>.</p> <p>Does anyone know how to fix that?</p> </div><!-- SC_ON --> &#32; submitted by &#32; <a href=\"https://www.reddit.com/user/brokesadnerd\"> /u/brokesadnerd </a> <br/> <span><a href=\"https://www.reddit.com/r/Affine/comments/1hmovfk/reset_after_update/\">[link]</a></span> &#32; <span><a href=\"https://www.reddit.com/r/Affine/comments/1hmovfk/reset_after_update/\">[comments]</a></span>","flags":null,"enclosureUrl":"","enclosureMime":""}]}